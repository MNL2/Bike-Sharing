<!DOCTYPE html>
<html>
    <head>
        <title>Bike Sharing - New York</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
            integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
        <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
            integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    </head>
    <body>
        <div id="map" style="height: 500px;"></div>
        <script>
            var map = L.map('map').setView([40.7128, -74.0060], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
            maxZoom: 18
            }).addTo(map);
            
            fetch("citybike.json")
                .then(response => response.json())
                .then(data => {
                    data.stationBeanList.forEach(station => {
                        const marker = L.marker([station.latitude, station.longitude]).addTo(map);
                        marker.bindPopup(station.stationName);
                    });
                })
                .catch(error => console.error(error));

                navigator.geolocation.getCurrentPosition(position => {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;
    const userMarker = L.marker([lat, lon]).addTo(map);
    userMarker.bindPopup('Posizione dell\'utente');
    
    if (data) {
        data.stationBeanList.forEach(station => {
            const marker = L.marker([station.latitude, station.longitude]).addTo(map);
            marker.bindPopup(station.stationName);
        });
    }
});

        </script>
    </body>
</html>